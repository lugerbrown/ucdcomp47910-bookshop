<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!-- Console appender for development -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{ISO8601} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- Security audit log file - CRITICAL for CWE-778 compliance -->
    <appender name="SECURITY_AUDIT_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/security-audit.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/security-audit.%d{yyyy-MM-dd}.%i.gz</fileNamePattern>
            <maxFileSize>50MB</maxFileSize>
            <maxHistory>90</maxHistory>
            <totalSizeCap>5GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%d{ISO8601} [SECURITY_AUDIT] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- Authentication audit log file -->
    <appender name="AUTH_AUDIT_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/auth-audit.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/auth-audit.%d{yyyy-MM-dd}.%i.gz</fileNamePattern>
            <maxFileSize>50MB</maxFileSize>
            <maxHistory>90</maxHistory>
            <totalSizeCap>5GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%d{ISO8601} [AUTH_AUDIT] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- Access control audit log file -->
    <appender name="ACCESS_AUDIT_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/access-audit.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/access-audit.%d{yyyy-MM-dd}.%i.gz</fileNamePattern>
            <maxFileSize>50MB</maxFileSize>
            <maxHistory>90</maxHistory>
            <totalSizeCap>5GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%d{ISO8601} [ACCESS_AUDIT] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- Application log file -->
    <appender name="APP_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/application.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>logs/application.%d{yyyy-MM-dd}.%i.gz</fileNamePattern>
            <maxFileSize>100MB</maxFileSize>
            <maxHistory>30</maxHistory>
            <totalSizeCap>3GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%d{ISO8601} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- Security audit loggers - specific loggers for SecurityAuditService -->
    <logger name="SECURITY_AUDIT" level="INFO" additivity="false">
        <appender-ref ref="SECURITY_AUDIT_FILE"/>
        <appender-ref ref="CONSOLE"/>
    </logger>

    <logger name="AUTH_AUDIT" level="INFO" additivity="false">
        <appender-ref ref="AUTH_AUDIT_FILE"/>
        <appender-ref ref="CONSOLE"/>
    </logger>

    <logger name="ACCESS_AUDIT" level="INFO" additivity="false">
        <appender-ref ref="ACCESS_AUDIT_FILE"/>
        <appender-ref ref="CONSOLE"/>
    </logger>

    <!-- Spring Security logging -->
    <logger name="org.springframework.security" level="DEBUG" additivity="false">
        <appender-ref ref="SECURITY_AUDIT_FILE"/>
        <appender-ref ref="CONSOLE"/>
    </logger>

    <!-- Database query logging for security events -->
    <logger name="org.hibernate.SQL" level="DEBUG" additivity="false">
        <appender-ref ref="APP_FILE"/>
    </logger>

    <!-- Default logger configuration -->
    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="APP_FILE"/>
    </root>

    <!-- Profile-specific configurations -->
    <springProfile name="production">
        <root level="WARN">
            <appender-ref ref="APP_FILE"/>
        </root>
        
        <!-- Enhanced security logging in production -->
        <logger name="SECURITY_AUDIT" level="INFO" additivity="false">
            <appender-ref ref="SECURITY_AUDIT_FILE"/>
        </logger>
        
        <logger name="AUTH_AUDIT" level="INFO" additivity="false">
            <appender-ref ref="AUTH_AUDIT_FILE"/>
        </logger>
        
        <logger name="ACCESS_AUDIT" level="INFO" additivity="false">
            <appender-ref ref="ACCESS_AUDIT_FILE"/>
        </logger>
    </springProfile>

    <springProfile name="development">
        <root level="DEBUG">
            <appender-ref ref="CONSOLE"/>
            <appender-ref ref="APP_FILE"/>
        </root>
    </springProfile>
</configuration>
